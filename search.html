<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search result</title>
    
    <link rel="stylesheet" href="/css/custom/search.css">
</head>
<body>
    <main>
        <header>
            <img src="/Assets/Images/logo.svg" alt="Logo MCTips">
            
            <h1>Search result</h1>

            <nav>
                <form method="GET" class="search">
                    <input type="text" name="search" id="search" placeholder="search articles" tabindex="1">
                </form>
    
                <div class="menu">
                    <div class="oppener">
                        <form method="dialog">
                            <input type="checkbox" name="menu" id="menu" style="display: none;">

                            <label for="menu">
                                menu

                                <div class="bars">
                                    <div class="bar1"></div>
                                    <div class="bar2"></div>
                                    <div class="bar3"></div>
                                </div>
                            </label>
                        </form>
                    </div>
    
                    <div class="menu-content">
                        <ul>
                            <li class="title">Build</li>
                            <li><!-- Name here --></li>
                        </ul>
                        <ul>
                            <li class="title">Redstone</li>
                            <li><!-- Name here --></li>
                        </ul>
                        <ul>
                            <li class="title">Command block</li>
                            <li><!-- Name here --></li>
                        </ul>
                        <ul>
                            <li class="title">Autre</li>
                            <li><!-- Name here --></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>

        <div class="content">            
            <div class="result-scroller">
                <div class="result">
                </div>
            </div>
        </div>

    </main>

    <script src="/js/headerMENU.js"></script>

    <script>
        let articlesContainer = document.querySelector('.result')

        let result = " result "
        typeof result === JSON

        let datas = result.sort((d1,d2) => d2.searchPoints - d1.searchPoints)
        let elementPrefix = '__'

        let xhr = new XMLHttpRequest()
        xhr.open("GET","article_template.html")
        xhr.send()
        xhr.onload = () => {
            for(let d of datas) {
                let doc = xhr.response

                let template = document.createElement('article')
                typeof template === XMLDocument
                template.innerHTML = doc
                
                for(let e in d) {
                    let docString = template.innerHTML.split(elementPrefix + e)
                    let elements = template.querySelectorAll(`.${elementPrefix}${e}`)

                    if(elements.length > 0) {
                        elements.forEach(el => {
                            el.innerText = '(' + d[e] + ')'
                        })
                    }else if(docString.length > 1) {
                        template.innerHTML = docString.join(d[e])
                    }
                }

                // check if element with "src" attribute as a src content
                let src = template.querySelectorAll('*[src]')
                if(src.length>0) {
                    src.forEach(s => {
                        let url = new URL(s.src)
                        let needDel = url.pathname.startsWith('/' + elementPrefix)
                        if(needDel) {
                            s.parentElement.removeChild(s)
                        }
                    })
                }

                articlesContainer.appendChild(template)
            }

        }

    </script>
</body>
</html>